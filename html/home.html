{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>The Atlas of Economic Complexity</title>
	<meta name="description" content="Networks in Macro Economics">
	<meta name="author" content="Alexander Simoes">
	
	<link rel="shortcut icon" type="image/x-icon" href="/media/img/favicon.ico">
	
	<!-- Load non-standard fonts -->
	<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow' rel='stylesheet' type='text/css' />
	<link href='http://fonts.googleapis.com/css?family=Cardo' rel='stylesheet' type='text/css' />
	
	<link rel="stylesheet" href="/media/css/normalize.css">
	<link rel="stylesheet" href="/media/css/style.css">
	<link rel="stylesheet" href="/media/css/home.css">
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>
<body class="home">
	<div id="container">
		<header>
			<div class="logo">
				<h1><a href="/" title="Home"><img src="/media/img/all/logo_observatory_sm.png" alt="The Observatory of Economic Complexity" /></a></h1>
			</div>
			<div class="nav">
				<ul>
					<li><a href="/app">Explore</a></li>
					<li><a href="/book">Book</a></li>
					<li><a href="/about">About</a></li>
					<li><a href="/api">API</a></li>
				</ul>
				<p>
					Change Language:
					{% for lang in supported_langs %}
						{% if lang.0 == LANGUAGE_CODE %}
						<a href="/set_language/{{lang.0}}/" title="{{lang.2}}"><img class="selected_lang" src="/media/img/icons/flag_{{lang.1}}.png" alt="{{lang.2}}" /></a>
						{% else %}
						<a href="/set_language/{{lang.0}}/" title="{{lang.2}}"><img src="/media/img/icons/flag_{{lang.1}}.png" alt="{{lang.2}}" /></a>
						{% endif %}
					{% endfor %}
				</p>
			</div>
			<br class="clear">
		</header>
	
		<div id="main" role="main">
		
			<div id="content">
				<div class="text">
					<h3>Nick-named the Baltic tiger, Estonia's exports have rapidly grown over the past 20 years.</h3>
					<p>Learn More...</p>
					<ul>
						<li><a href="/app/treemap/export/est/2009/">Estonia's exports</a></li>
						<li><a href="/app/treemap/import/est/2009/">Estonia's imports</a></li>
						<li><a href="/app/product_space/export/est/2009/">Estonia in the product space</a></li>
					</ul>
				</div>
				<div class="headline">
					<div class="overlay">
						<img class="pin" src="http://www.crossed-flag-pins.com/Friendship-Pins/Estonia/Flag-Pins-Estonia-Estonia.jpg" />
						<h2>Estonia</h2>
					</div>
					<img src="/media/img/home/est_front_page.png" />
				</div>
				<div class="other_apps">
					<h3>Explore More Apps</h3>
					<div class="item">
						<a href="/app/treemap/export/est/2009/"><img src="/media/img/home/teaser_tree_map.png"></a>
					</div>
					<div class="item">
						<a href="/app/stacked/export/est/1990.2008.2/"><img src="/media/img/home/teaser_stacked.png"></a>
					</div>
					<div class="item">
						<a href="/app/product_space/export/est/2009/"><img src="/media/img/home/teaser_product_space.png"></a>
					</div>
				</div>
			</div>
		
			<br class="clear" />

		</div> <!-- END #main -->
	
		<footer>
			<p>The Observatory of Economic Complexity, Copyright &copy; 2011 <a href="http://www.mit.edu">Massachusetts Institute of Technology</a>, <a href="http://media.mit.edu/">The Media Lab</a>, <a href="http://macroconnections.media.mit.edu">Macro Connections Group</a> | <a href="http://www.harvard.edu">Harvard University</a>, <a href="http://http://www.hks.harvard.edu/centers/cid">Center for International Development</a></p>
		</footer>
	
	</div> <!-- END #container -->
	
	<!-- <img id="bg_containers" src="/media/img/all/containers.png" /> -->
	
	<script src="/media/js/libs/jquery/jquery-1.7.1.min.js"></script>
	<script type="text/javascript">

		// On window load. This waits until images have loaded which is essential
		$(window).load(function(){

			// Fade in images so there isn't a color "pop" document load and then on window load
			$(".item img").fadeIn(500);

			// clone image
			$('.item img').each(function(){
				var el = $(this);
				el.css({"position":"absolute"}).wrap("<div class='img_wrapper' style='display: inline-block'>").clone().addClass('img_grayscale').css({"position":"absolute","z-index":"998","opacity":"0"}).insertBefore(el).queue(function(){
					var el = $(this);
					el.parent().css({"width":this.width,"height":this.height});
					el.dequeue();
				});
				this.src = grayscale(this.src);
			});

			// Fade image 
			$('.item img').mouseover(function(){
				$(this).parent().find('img:first').stop().animate({opacity:1}, 500);
			})
			$('.img_grayscale').mouseout(function(){
				$(this).stop().animate({opacity:0}, 500);
			});		
		});

		// Grayscale w canvas method
		function grayscale(src){
			var canvas = document.createElement('canvas');
			var ctx = canvas.getContext('2d');
			var imgObj = new Image();
			imgObj.src = src;
			canvas.width = imgObj.width;
			canvas.height = imgObj.height; 
			ctx.drawImage(imgObj, 0, 0); 
			var imgPixels = ctx.getImageData(0, 0, canvas.width, canvas.height);
			for(var y = 0; y < imgPixels.height; y++){
				for(var x = 0; x < imgPixels.width; x++){
					var i = (y * 4) * imgPixels.width + x * 4;
					var avg = (imgPixels.data[i] + imgPixels.data[i + 1] + imgPixels.data[i + 2]) / 3;
					imgPixels.data[i] = avg; 
					imgPixels.data[i + 1] = avg; 
					imgPixels.data[i + 2] = avg;
				}
			}
			ctx.putImageData(imgPixels, 0, 0, 0, 0, imgPixels.width, imgPixels.height);
			return canvas.toDataURL();
	    }

	</script>
	
</body>
</html>