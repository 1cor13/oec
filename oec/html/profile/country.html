{% extends "templates/site.html" %}

{% block head %}
  <link type="text/css" rel="stylesheet" media="all" href="/static/css/styles.profile.css" />
  <link type="text/css" rel="stylesheet" media="all" href="/static/css/styles.table.css" />
{% endblock %}

{% block title %}: {{ attr.get_name() }} ({{ attr.get_display_id()|upper }}) Profile{% endblock %}

{% block body %}
<h2>Learn More About Trade in {{ attr.get_name() }}</h2>

<div class="content">
    
  <div class="col1_5">
    <p class="country_name"><img src="{{ attr.get_icon() }}" alt="{{ attr.get_name() }} icon">{{ attr.get_name() }}</p>
    {% set top_prods = attr.get_top(10) %}
    {% if attr.get_attr_yo().eci_rank %}
      <p class="eci_value">
        {{ attr.get_name() }} is <a href="/rankings/country/">ranked</a> <span class="rank">{{ attr.get_attr_yo().eci_rank }}</span> with an Economic Complexity Index (ECI) of {{ attr.get_attr_yo().eci }}.
      </p>
    {% endif %}
    {% if top_prods %}
      <p class="eci_value">
        {{ attr.get_name() }} is the top exporter of {% for yp in top_prods %} {% if loop.last and loop.length > 1 %}and {% endif %}<a href="{{ yp.product.get_profile_url() }}">{{ yp.product.get_name() }}</a>{% if not loop.last %}, {% endif %}{% endfor %}.
      </p>
    {% endif %}
  </div><div class="col2">
    <table class="striped">
      {% for b in builds %}
      {% set stats = b.top_stats(5) %}
      <tr>
        <th>Top 5 {{ b.get_name() }}</th>
        <td>
          {% for entry in stats.entries %}
          {% if loop.last %}and {% endif %}<a href="{{ entry.attr.get_profile_url() }}">{{ entry.attr.get_name() }}</a> ({{ entry.share|format_percent }}){% if not loop.last %}, {% endif %}
          {% endfor %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
      
  <br>
    
  {% for b in builds %}
    {% set stats = b.top_stats(20) %}
    <div class="build">
      <h3>{{ b.get_question() }}</h3>
      <iframe id="iframe_viz" src="/explore/embed/{{ b.url() }}?controls=false" width="460" height="300" frameborder="0"></iframe>
      <div class="list">
        <table class="striped condensed">
        {% for entry in stats.entries %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ entry.attr.get_abbrv()|upper }}</td>
            <td><a href="{{ entry.attr.get_profile_url() }}">{{ entry.attr.get_name() }}</a></td>
            <td>{{ entry.value|format_currency }}</td>
            <td>{{ entry.share|format_percent }}</td>
          </tr>
        {% endfor %}
        </table>
      </div>
      <a class="button" href="/explore/{{ b.url() }}">View as Visualization Â»</a>
    </div>
  {% endfor %}


</div> 
{% endblock %}


{% block js %}
<script>
  // Add color to rankings
  var color = d3.scale.linear()
    .domain([0, 128])
    .interpolate(d3.interpolateRgb)
    .range(["#00cc00", "#cc0000"])

  d3.select("span.rank")
    .style("background-color", function(d, i){
      return color(parseInt(this.innerHTML));
    })
    .style("color", function(d, i){
      return d3plus.color.text(color(parseInt(this.innerHTML)));
    })
</script>
{% endblock %}