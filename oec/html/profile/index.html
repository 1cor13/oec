{% extends "templates/nav.html" %}

{% block body %}

<header>
  <img id="header" src="{{ profile.attr.get_image() }}"></img>
  <img id="icon" src="{{ profile.attr.get_icon() }}">
  <h1>{{ profile.title() }}</h1>
</header>

<section id="stats">
  <div class="stat">
    <sub>Exports</sub>
    <h3>$4.5B</h3>
  </div>
  <div class="stat">
    <sub>Imports</sub>
    <h3>$3.7T</h3>
  </div>
  <div class="stat">
    <sub>ECI</sub>
    <h3>1.34</h3>
  </div>
  <div class="stat">
    <sub>Population</sub>
    <h3>4.3M</h3>
  </div>
  <div class="stat">
    <sub>GDP</sub>
    <h3>$25k</h3>
  </div>
</section>

<section>

  <aside>
    <div class="viz"></div>
  </aside>

  <content>
    <h2>{% trans %}Introduction{% endtrans %}</h2>
    {% for p in profile.intro() %}
      <p>{{ p|safe }}</p>
    {% endfor %}
  </content>

</section>

{% for section in profile.sections() %}
<section>
  <aside></aside>
  <content>
    <h2>{{ section.title }}</h2>
    {% if section.subtitle %}
    <p>{{ section.subtitle }}</p>
    {% endif %}
  <content>
</section>
{% for build in section.builds %}
<section>
  <aside>
    <h2>{{ build.title }}</h2>
    {% if build.subtitle %}
    <p>{{ build.subtitle }}</>
    {% endif %}
  </aside>

  <content>
    {% if build.iframe %}
    <iframe class="viz" src="{{ build.iframe }}"></iframe>
    {% else %}
    <div class="viz"></div>
    {% endif %}
  </content>

</section>
{% endfor %}
{% endfor %}

<script>
  var palette = JSON.parse("{{ profile.palette()|safe }}".replace(/'/g, '"')),
      color;
  for (var p = 0; p < palette.length; p++) {
    var c = d3.hsl(palette[p]);
    if (c.l > 0.5) {
      color = d3plus.color.legible(palette[p]);
      break;
    }
  }
  if (!color) color = palette[1];
</script>
{% endblock %}
