{% extends "templates/site.html" %}

{% block head %}
    {% if year > g.available_years[category][0]  %}
    <link rel="prev" href="/rankings/{{ category }}/{{ year-1 }}/" />
    {% endif %}
    {% if year < g.available_years[category][-1]  %}
    <link rel="next" href="/rankings/{{ category }}/{{ year+1 }}/" />
    {% endif %}
    <link type="text/css" rel="stylesheet" media="all" href="/static/css/styles.rankings.css" />
    <link type="text/css" rel="stylesheet" media="all" href="/static/css/styles.table.css" />
{% endblock %}

{% block title %}: {% if category == "country" %}{{ category|title }}{% else %}{{ category|upper }} Product{% endif %} Ranking ({{ year }}){% endblock %}

{% block body %}
<!-- the left pane -->
<div class="content">
  
  <div id="sidebar" class="col1">
    
    <ul>
      <li{% if category == "country" %} class="active"{% endif %}>
        <a href="/rankings/country/">Country Rankings</a>
      </li>
      <li{% if category == "hs" %} class="active"{% endif %}>
        <a href="/rankings/hs/">HS Product Rankings</a>
      </li>
      <li{% if category == "sitc" %} class="active"{% endif %}>
        <a href="/rankings/sitc/">SITC Product Rankings</a>
      </li>
    </ul>
    
    <h3>Download</h3>
    <p>
      <a href="/rankings/{{ category }}/year/download/">&raquo; Download year data</a><br />
      <a href="/rankings/{{ category }}/download/">&raquo; Download all years data</a>
    </p>
  
  </div><div class="col3">
  
    <div class="change_year">
        {% if year > g.available_years[category][0]  %}
        <a class="prev" href="/rankings/{{ category }}/{{ year-1 }}/">&laquo; Previous Year</a>
        {% endif %}
        <div class="dropdown">
          <select>
            {% for y in years %}
            <option value="{{ y }}" {% if y == year %}selected="selected"{% endif %}>{{ y }}</option>
            {% endfor %}
          </select>
        </div>
        {% if year < g.available_years[category][-1]  %}
        <a class="next" href="/rankings/{{ category }}/{{ year+1 }}/">Next Year &raquo;</a>
        {% endif %}
      </div>
  
      <table class="sortable">
        <thead>
          <tr>
          
            {% for c in cols %}
            <th><a class="sort">{{ c }}</a></th>
            {% endfor %}
          
          </tr>
        </thead>
      
        <tbody>
        
          {% for r in rankings %}
          <tr>
            {% if category == "country" %}
            <td><span>{{ r["eci_rank"] }}</span></td>
            <td>{{ r.country.id_3char|upper }}</td>
            <td><a href="{{ r.country.get_profile_url() }}">{{ r.country.get_name() }}</a></td>
            <td>{{ r.eci }}</td>
            {% else %}
            <td><span>{{ r["pci_rank"] }}</span></td>
            <td>{{ r.product.get_display_id() }}</td>
            <td><a href="{{ r.product.get_profile_url() }}">{{ r.product.get_name() }}</a></td>
            <td>{{ r.pci }}</td>
            {% endif %}
          </tr>
          {% endfor %}
        
        </tbody>
    
      </table>
  
  </div>

</div>
{% endblock %}


{% block js %}
  <script>
    var total = d3.selectAll("tbody tr")[0].length
    // Add color to rankings
    var color = d3.scale.linear()
      .domain([0, total/2, total-1])
      .interpolate(d3.interpolateRgb)
      .range(["#00cc00", "#cccccc", "#cc0000"])
    d3.selectAll("tbody tr").select("td span")
      .style("background", function(d, i){
        return color(i);
      })
      .style("color", "white")
      // .style("color", function(d, i){
      //   return d3plus.color.text(color(i));
      // })
    d3.select(".dropdown select").on("change", function(){
      var new_year = d3.select(this[this.selectedIndex]).property("value")
      var url = window.location.pathname.split("/")
      if(url.length == 5){
        url.splice(3, 1, new_year)
      }
      else {
        url.splice(3, 0, new_year)
      }
      window.location = url.join("/")
    })
  
  </script>
{% endblock %}